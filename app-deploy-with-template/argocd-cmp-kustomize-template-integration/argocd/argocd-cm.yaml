apiVersion: v1
kind: ConfigMap
metadata:
  name: kustomize-template-integration-plugin-config
data:
  plugin.yaml: |
    apiVersion: argoproj.io/v1alpha1
    kind: ConfigManagementPlugin
    metadata:
      name: kustomize-template-integration-plugin
    spec:
      version: v1.0
      init:
        command:
          - sh
          - -c
          - "oc process --param-file=$PARAM_PARAMS_FILE -f . -o yaml --local > base/generated-manifests/app.yaml"
      generate:
        command:
          - sh
          - -c
          - "oc kusotomize overlay/$PARAM_CLUSTER_NAME/$PARAM_ENV_NAME"
      discover:
        fileName: "./*.yaml"
      parameters:
        static:
          - name: cluster-name
            title: cluster-name
            required: true
          - name: env-name
            title: env-name
            required: true
